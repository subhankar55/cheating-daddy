<!doctype html>
<html>
    <head>
        <!-- Allow https: for dev (CDN) so UMD React can load when using Live Server -->
        <meta http-equiv="content-security-policy" content="script-src 'self' 'unsafe-inline' https:;" />
        <title>Screen and Audio Capture</title>
        <style>
            :root {
                --background-transparent: transparent;
                --text-color: #e5e5e7;
                --border-color: rgba(255, 255, 255, 0.2);
                --header-background: rgba(0, 0, 0, 0.8);
                --header-actions-color: rgba(255, 255, 255, 0.6);
                --main-content-background: rgba(0, 0, 0, 0.8);
                --button-background: rgba(0, 0, 0, 0.5);
                --button-border: rgba(255, 255, 255, 0.1);
                --icon-button-color: rgb(229, 229, 231);
                --hover-background: rgba(255, 255, 255, 0.1);
                --input-background: rgba(0, 0, 0, 0.3);
                --placeholder-color: rgba(255, 255, 255, 0.4);
                --focus-border-color: #007aff;
                --focus-box-shadow: rgba(0, 122, 255, 0.2);
                --input-focus-background: rgba(0, 0, 0, 0.5);
                --scrollbar-track: rgba(0, 0, 0, 0.2);
                --scrollbar-thumb: rgba(255, 255, 255, 0.2);
                --scrollbar-thumb-hover: rgba(255, 255, 255, 0.3);
                --preview-video-background: rgba(0, 0, 0, 0.9);
                --preview-video-border: rgba(255, 255, 255, 0.15);
                --option-label-color: rgba(255, 255, 255, 0.8);
                --screen-option-background: rgba(0, 0, 0, 0.4);
                --screen-option-hover-background: rgba(0, 0, 0, 0.6);
                --screen-option-selected-background: rgba(0, 122, 255, 0.15);
                --screen-option-text: rgba(255, 255, 255, 0.7);
                --description-color: rgba(255, 255, 255, 0.6);
                --start-button-background: white;
                --start-button-color: black;
                --start-button-border: white;
                --start-button-hover-background: rgba(255, 255, 255, 0.8);
                --start-button-hover-border: rgba(0, 0, 0, 0.2);
                --text-input-button-background: #007aff;
                --text-input-button-hover: #0056b3;
                --link-color: #007aff;
                --key-background: rgba(255, 255, 255, 0.1);
                --scrollbar-background: rgba(0, 0, 0, 0.4);

                /* Layout-specific variables */
                --header-padding: 10px 20px;
                --header-font-size: 16px;
                --header-gap: 12px;
                --header-button-padding: 8px 16px;
                --header-icon-padding: 8px;
                --header-font-size-small: 13px;
                --main-content-padding: 20px;
                --main-content-margin-top: 10px;
                --icon-size: 24px;
                --border-radius: 10px;
                --content-border-radius: 10px;
            }

            /* Compact layout styles */
            :root.compact-layout {
                --header-padding: 6px 12px;
                --header-font-size: 13px;
                --header-gap: 6px;
                --header-button-padding: 4px 8px;
                --header-icon-padding: 4px;
                --header-font-size-small: 10px;
                --main-content-padding: 10px;
                --main-content-margin-top: 2px;
                --icon-size: 16px;
                --border-radius: 4px;
                --content-border-radius: 4px;
            }

            html,
            body {
                margin: 0;
                padding: 0;
                height: 100%;
                overflow: hidden;
                background: transparent;
            }

            body {
                font-family:
                    'Inter',
                    -apple-system,
                    BlinkMacSystemFont,
                    sans-serif;
            }

            * {
                box-sizing: border-box;
            }

            cheating-daddy-app {
                display: block;
                width: 100%;
                height: 100%;
            }
        </style>
    </head>
    <body>
        <script src="assets/marked-4.3.0.min.js"></script>
        <script src="assets/highlight-11.9.0.min.js"></script>
        <link rel="stylesheet" href="assets/highlight-vscode-dark.min.css" />

        <!-- Mount point for React app. The bundled UI is created by esbuild into `src/dist/react-ui.js`. -->
        <div id="cheddar-root">
            <!-- Fallback static UI for Live Server / missing bundle so something always appears -->
            <div style="padding:16px;color:var(--text-color);">
                <header style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
                    <div>
                        <strong>Cheating Daddy (Fallback UI)</strong>
                        <div style="font-size:12px;color:var(--description-color);">Development fallback interface</div>
                    </div>
                    <div>
                        <span id="fallback-status" style="margin-right:12px;font-size:13px;">Status: Idle</span>
                        <button id="fallback-start" style="padding:6px 10px;margin-right:6px;">Start</button>
                        <button id="fallback-stop" style="padding:6px 10px;">Stop</button>
                    </div>
                </header>
                <main style="display:grid;grid-template-columns:1fr 320px;gap:12px;">
                    <section style="background:var(--main-content-background);padding:12px;border-radius:var(--content-border-radius);">
                        <h3>Capture Controls</h3>
                        <p style="color:var(--description-color);">Fallback controls when React bundle isn't available.</p>
                        <div>
                            <label style="margin-right:8px;">Interval (s):</label>
                            <input id="fallback-interval" type="number" value="5" min="1" style="width:80px;" />
                        </div>
                        <div style="margin-top:8px;">
                            <button id="fallback-manual" style="padding:6px 10px;">Manual Screenshot</button>
                        </div>
                    </section>
                    <aside style="background:rgba(0,0,0,0.6);padding:12px;border-radius:var(--content-border-radius);">
                        <h4>Response Preview</h4>
                        <div id="fallback-response" style="white-space:pre-wrap;color:var(--description-color);max-height:300px;overflow:auto;">No response yet</div>
                    </aside>
                </main>
            </div>
        </div>

        <!-- Bundled React UI (built with esbuild) -->
        <script src="dist/react-ui.js"></script>

        <!-- Inline fallback wiring: connect buttons to available renderer APIs when bundle is missing -->
        <script>
            (function(){
                const startBtn = document.getElementById('fallback-start');
                const stopBtn = document.getElementById('fallback-stop');
                const manualBtn = document.getElementById('fallback-manual');
                const statusEl = document.getElementById('fallback-status');
                const responseEl = document.getElementById('fallback-response');

                function setStatus(s){
                    if(statusEl) statusEl.textContent = 'Status: ' + s;
                }

                startBtn && startBtn.addEventListener('click', ()=>{
                    setStatus('Starting...');
                    if(window.cheddar && typeof window.cheddar.startCapture === 'function'){
                        window.cheddar.startCapture();
                        setStatus('Live');
                    } else {
                        setStatus('Start API not available');
                    }
                });

                stopBtn && stopBtn.addEventListener('click', ()=>{
                    setStatus('Stopping...');
                    if(window.cheddar && typeof window.cheddar.stopCapture === 'function'){
                        window.cheddar.stopCapture();
                        setStatus('Idle');
                    } else {
                        setStatus('Stop API not available');
                    }
                });

                manualBtn && manualBtn.addEventListener('click', async ()=>{
                    setStatus('Manual screenshot...');
                    try{
                        if(typeof window.captureManualScreenshot === 'function'){
                            await window.captureManualScreenshot();
                            setStatus('Manual screenshot sent');
                        } else {
                            setStatus('Manual API not available');
                        }
                    }catch(e){
                        setStatus('Error');
                        console.error(e);
                    }
                });

                // If the React bridge appears, let it update the fallback response/status
                const bridgeCheck = setInterval(()=>{
                    if(window._reactAppApi){
                        // Let the React UI take over; stop updating fallback
                        clearInterval(bridgeCheck);
                        // Mirror status from bridge if possible
                        if(window._reactAppApi.setStatus) window._reactAppApi.setStatus = (s)=>{ setStatus(s); };
                        if(window._reactAppApi.setResponse) window._reactAppApi.setResponse = (r)=>{ if(responseEl) responseEl.textContent = r; };
                    }
                },200);
            })();
        </script>

        <!-- Existing renderer helpers (keeps capture, audio and IPC logic) -->
        <script src="utils/renderer.js"></script>
    </body>
</html>
